!function(e){"use strict";function i(t,i){this.itemsArray=[],this.$element=e(t),this.$element.hide(),this.isSelect="SELECT"===t.tagName,this.multiple=this.isSelect&&t.hasAttribute("multiple"),this.objectItems=i&&i.itemValue,this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=e('<div class="bootstrap-tagsinput"></div>'),this.$input=e('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.before(this.$container),this.build(i)}function s(e,t){if("function"!=typeof e[t]){var i=e[t];e[t]=function(e){return e[i]}}}function r(e,t){if("function"!=typeof e[t]){var i=e[t];e[t]=function(){return i}}}function l(e){return e?n.text(e).html():""}function o(e){var t=0;if(document.selection){e.focus();var i=document.selection.createRange();i.moveStart("character",-e.value.length),t=i.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function a(t,i){var s=!1;return e.each(i,function(e,i){if("number"==typeof i&&t.which===i)return s=!0,!1;if(t.which===i.which){var r=!i.hasOwnProperty("altKey")||t.altKey===i.altKey,n=!i.hasOwnProperty("shiftKey")||t.shiftKey===i.shiftKey,l=!i.hasOwnProperty("ctrlKey")||t.ctrlKey===i.ctrlKey;if(r&&n&&l)return s=!0,!1}}),s}var t={tagClass:function(){return"label label-info"},itemValue:function(e){return e?e.toString():e},itemText:function(e){return this.itemValue(e)},itemTitle:function(){return null},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!0,onTagExists:function(e,t){t.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};i.prototype={constructor:i,add:function(t,i,s){var r=this;if(!(r.options.maxTags&&r.itemsArray.length>=r.options.maxTags||t!==!1&&!t)){if("string"==typeof t&&r.options.trimValue&&(t=e.trim(t)),"object"==typeof t&&!r.objectItems)throw"Can't add objects when itemValue option is not set";if(!t.toString().match(/^\s*$/)){if(r.isSelect&&!r.multiple&&r.itemsArray.length>0&&r.remove(r.itemsArray[0]),"string"==typeof t&&"INPUT"===this.$element[0].tagName){var n=r.options.delimiterRegex?r.options.delimiterRegex:r.options.delimiter,o=t.split(n);if(o.length>1){for(var a=0;a<o.length;a++)this.add(o[a],!0);return void(i||r.pushVal())}}var h=r.options.itemValue(t),c=r.options.itemText(t),u=r.options.tagClass(t),d=r.options.itemTitle(t),f=e.grep(r.itemsArray,function(e){return r.options.itemValue(e)===h})[0];if(!f||r.options.allowDuplicates){if(!(r.items().toString().length+t.length+1>r.options.maxInputLength)){var p=e.Event("beforeItemAdd",{item:t,cancel:!1,options:s});if(r.$element.trigger(p),!p.cancel){r.itemsArray.push(t);var g=e('<span class="tag '+l(u)+(null!==d?'" title="'+d:"")+'">'+l(c)+'<span data-role="remove"></span></span>');if(g.data("item",t),r.findInputWrapper().before(g),g.after(" "),r.isSelect&&!e('option[value="'+encodeURIComponent(h)+'"]',r.$element)[0]){var m=e("<option selected>"+l(c)+"</option>");m.data("item",t),m.attr("value",h),r.$element.append(m)}i||r.pushVal(),(r.options.maxTags===r.itemsArray.length||r.items().toString().length===r.options.maxInputLength)&&r.$container.addClass("bootstrap-tagsinput-max"),r.$element.trigger(e.Event("itemAdded",{item:t,options:s}))}}}else if(r.options.onTagExists){var _=e(".tag",r.$container).filter(function(){return e(this).data("item")===f});r.options.onTagExists(t,_)}}}},remove:function(t,i,s){var r=this;if(r.objectItems&&(t="object"==typeof t?e.grep(r.itemsArray,function(e){return r.options.itemValue(e)==r.options.itemValue(t)}):e.grep(r.itemsArray,function(e){return r.options.itemValue(e)==t}),t=t[t.length-1]),t){var n=e.Event("beforeItemRemove",{item:t,cancel:!1,options:s});if(r.$element.trigger(n),n.cancel)return;e(".tag",r.$container).filter(function(){return e(this).data("item")===t}).remove(),e("option",r.$element).filter(function(){return e(this).data("item")===t}).remove(),-1!==e.inArray(t,r.itemsArray)&&r.itemsArray.splice(e.inArray(t,r.itemsArray),1)}i||r.pushVal(),r.options.maxTags>r.itemsArray.length&&r.$container.removeClass("bootstrap-tagsinput-max"),r.$element.trigger(e.Event("itemRemoved",{item:t,options:s}))},removeAll:function(){var t=this;for(e(".tag",t.$container).remove(),e("option",t.$element).remove();t.itemsArray.length>0;)t.itemsArray.pop();t.pushVal()},refresh:function(){var t=this;e(".tag",t.$container).each(function(){var i=e(this),s=i.data("item"),r=t.options.itemValue(s),n=t.options.itemText(s),o=t.options.tagClass(s);if(i.attr("class",null),i.addClass("tag "+l(o)),i.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=l(n),t.isSelect){var a=e("option",t.$element).filter(function(){return e(this).data("item")===s});a.attr("value",r)}})},items:function(){return this.itemsArray},pushVal:function(){var t=this,i=e.map(t.items(),function(e){return t.options.itemValue(e).toString()});t.$element.val(i,!0).trigger("change")},build:function(i){var n=this;if(n.options=e.extend({},t,i),n.objectItems&&(n.options.freeInput=!1),s(n.options,"itemValue"),s(n.options,"itemText"),r(n.options,"tagClass"),n.options.typeahead){var l=n.options.typeahead||{};r(l,"source"),n.$input.typeahead(e.extend({},l,{source:function(t,i){function s(e){for(var t=[],s=0;s<e.length;s++){var l=n.options.itemText(e[s]);r[l]=e[s],t.push(l)}i(t)}this.map={};var r=this.map,o=l.source(t);e.isFunction(o.success)?o.success(s):e.isFunction(o.then)?o.then(s):e.when(o).then(s)},updater:function(e){return n.add(this.map[e]),this.map[e]},matcher:function(e){return-1!==e.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(e){return e.sort()},highlighter:function(e){var t=new RegExp("("+this.query+")","gi");return e.replace(t,"<strong>$1</strong>")}}))}if(n.options.typeaheadjs){var h=null,c={},u=n.options.typeaheadjs;e.isArray(u)?(h=u[0],c=u[1]):c=u,n.$input.typeahead(h,c).on("typeahead:selected",e.proxy(function(e,t){n.add(c.valueKey?t[c.valueKey]:t),n.$input.typeahead("val","")},n))}n.$container.on("click",e.proxy(function(){n.$element.attr("disabled")||n.$input.removeAttr("disabled"),n.$input.focus()},n)),n.options.addOnBlur&&n.options.freeInput&&n.$input.on("focusout",e.proxy(function(){0===e(".typeahead, .twitter-typeahead",n.$container).length&&(n.add(n.$input.val()),n.$input.val(""))},n)),n.$container.on("keydown","input",e.proxy(function(t){var i=e(t.target),s=n.findInputWrapper();if(n.$element.attr("disabled"))return void n.$input.attr("disabled","disabled");switch(t.which){case 8:if(0===o(i[0])){var r=s.prev();r.length&&n.remove(r.data("item"))}break;case 46:if(0===o(i[0])){var l=s.next();l.length&&n.remove(l.data("item"))}break;case 37:var a=s.prev();0===i.val().length&&a[0]&&(a.before(s),i.focus());break;case 39:var h=s.next();0===i.val().length&&h[0]&&(h.after(s),i.focus())}{var c=i.val().length;Math.ceil(c/5)}i.attr("size",Math.max(this.inputSize,i.val().length))},n)),n.$container.on("keypress","input",e.proxy(function(t){var i=e(t.target);if(n.$element.attr("disabled"))return void n.$input.attr("disabled","disabled");var s=i.val(),r=n.options.maxChars&&s.length>=n.options.maxChars;n.options.freeInput&&(a(t,n.options.confirmKeys)||r)&&(0!==s.length&&(n.add(r?s.substr(0,n.options.maxChars):s),i.val("")),n.options.cancelConfirmKeysOnEmpty===!1&&t.preventDefault());{var l=i.val().length;Math.ceil(l/5)}i.attr("size",Math.max(this.inputSize,i.val().length))},n)),n.$container.on("click","[data-role=remove]",e.proxy(function(t){n.$element.attr("disabled")||n.remove(e(t.target).closest(".tag").data("item"))},n)),n.options.itemValue===t.itemValue&&("INPUT"===n.$element[0].tagName?n.add(n.$element.val()):e("option",n.$element).each(function(){n.add(e(this).attr("value"),!0)}))},destroy:function(){var e=this;e.$container.off("keypress","input"),e.$container.off("click","[role=remove]"),e.$container.remove(),e.$element.removeData("tagsinput"),e.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var t=this.$input[0],i=this.$container[0];t&&t.parentNode!==i;)t=t.parentNode;return e(t)}},e.fn.tagsinput=function(t,s,r){var n=[];return this.each(function(){var l=e(this).data("tagsinput");if(l)if(t||s){if(void 0!==l[t]){if(3===l[t].length&&void 0!==r)var o=l[t](s,null,r);else var o=l[t](s);void 0!==o&&n.push(o)}}else n.push(l);else l=new i(this,t),e(this).data("tagsinput",l),n.push(l),"SELECT"===this.tagName&&e("option",e(this)).attr("selected","selected"),e(this).val(e(this).val())}),"string"==typeof t?n.length>1?n:n[0]:n},e.fn.tagsinput.Constructor=i;var n=e("<div />");e(function(){e("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);